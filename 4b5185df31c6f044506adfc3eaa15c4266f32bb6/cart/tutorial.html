

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ngChat Cart Tutorial &mdash; ngChat 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ngChat-FAQ" href="../ngchat/faq.html" />
    <link rel="prev" title="ngChat Policy Tutorial" href="../policy/policy_tutorial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> ngChat
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../ngchat/index.html">ngChat</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ngchat/quickstart.html">ngChat Quick Start</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../ngchat/bot_tutorial.html">ngChat Bot Tutorial</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../policy/policy_tutorial.html">ngChat Policy Tutorial</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ngChat Cart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ngchat/faq.html">ngChat-FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ngchat/quickstart.html">ngChat Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ngchat/faq.html">ngChat-FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../speech/index.html">Welcome to ngChat-speech’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report/index.html">Welcome to ngChat-report’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to ngChat Cart’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy/index.html">Welcome to ngChat Policy’s documentation!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ngChat</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../ngchat/index.html">Welcome to ngChat’s documentation!</a> &raquo;</li>
        
          <li><a href="../ngchat/bot_tutorial.html">ngChat Bot Tutorial</a> &raquo;</li>
        
      <li>ngChat Cart Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/cart/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p id="cart-tutorial">TODO: rework tutorial to use tutorial bot</p>
<div class="section" id="ngchat-cart-tutorial">
<h1>ngChat Cart Tutorial<a class="headerlink" href="#ngchat-cart-tutorial" title="Permalink to this headline">¶</a></h1>
<dl class="simple">
<dt>This tutorial will walk through how to utilize ngChat Cart for an e-commerce chatbot. It will demonstrate how to:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#creating-the-menu"><span class="std std-ref">Create a menu with the proper schema</span></a></p></li>
<li><p><a class="reference internal" href="#combo-item-example"><span class="std std-ref">Express complex items on the menu</span></a></p></li>
<li><p><a class="reference internal" href="#generating-lookup-tables-chatette-templates"><span class="std std-ref">Automatically generate training data from the menu</span></a></p></li>
<li><p><a class="reference internal" href="#writing-the-cart-config-yml-file"><span class="std std-ref">Configure the cart</span></a> - <a class="reference internal" href="#integrating-with-rasa"><span class="std std-ref">Integrate the cart into bot actions</span></a></p></li>
</ul>
</dd>
</dl>
<p>For this tutorial we will imagine that we are building a new coffee shop bot from the ground up. Take it that the new bot can already handle basic intents, and can extract entities to slots. From there we will walk through adding menu and cart support.
For more detailed information about why and how the cart is implemented, see the <a class="reference internal" href="readme.html#cart-readme"><span class="std std-ref">readme</span></a> or the
<a class="reference internal" href="ngchat_cart.html#ngchat-cart"><span class="std std-ref">technical documentation</span></a>.</p>
<div class="section" id="quickstart-guide">
<h2>Quickstart Guide<a class="headerlink" href="#quickstart-guide" title="Permalink to this headline">¶</a></h2>
<p>TODO: a shorter summary of the things talked in detail</p>
</div>
<div class="section" id="creating-the-menu">
<h2>Creating the Menu<a class="headerlink" href="#creating-the-menu" title="Permalink to this headline">¶</a></h2>
<p>Creating the menu can be approached a few different ways; if a virtual copy of the menu already exists, using a script to convert it to the ngChat Cart format may be the quickest. It is also possible to scrape the menu from a website, or write it by hand.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Menus can become quite large (Starbucks is over 100,000 lines), so it is highly encourage to automate as much of this process as possible to avoid tedious menu construction by hand.</p>
</div>
<div class="section" id="main-components">
<h3>Main Components<a class="headerlink" href="#main-components" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">menu</span></code> consists of four top-level components: <code class="docutils literal notranslate"><span class="pre">store_name</span></code>, <code class="docutils literal notranslate"><span class="pre">currency</span></code>, <code class="docutils literal notranslate"><span class="pre">products</span></code>, and <code class="docutils literal notranslate"><span class="pre">modifiers</span></code>. The first two are quite simple to fill out:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;store_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Coffee Shop&quot;</span><span class="p">,</span>
    <span class="nt">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">store_name</span></code> and <code class="docutils literal notranslate"><span class="pre">currency</span></code> should both be strings, and the <code class="docutils literal notranslate"><span class="pre">currency</span></code> should be represented as the standard three-letter abbreviation for that currency. The <code class="docutils literal notranslate"><span class="pre">products</span></code> and <code class="docutils literal notranslate"><span class="pre">modifiers</span></code> fields of the menu are lists containing information about all the items available for purchase and how they can be modified. <code class="docutils literal notranslate"><span class="pre">products</span></code> are items that can be purchased on their own, while <code class="docutils literal notranslate"><span class="pre">modifiers</span></code> can only be added to a user’s cart if they’re attached to a product.</p>
</div>
<div class="section" id="the-product-list">
<h3>The Product list<a class="headerlink" href="#the-product-list" title="Permalink to this headline">¶</a></h3>
<p>For our basic item example, we’ll consider an <code class="docutils literal notranslate"><span class="pre">Americano</span></code>. For this item, the customer must specify if they want room or not. Additionally, they can ask for sweetener packets. To add this product to the menu, we will add a new entry to the product list:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;store_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Coffee Shop&quot;</span><span class="p">,</span>
    <span class="nt">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
    <span class="nt">&quot;products&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Americano&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-item-example">
<h3>Basic Item Example<a class="headerlink" href="#basic-item-example" title="Permalink to this headline">¶</a></h3>
<p><strong>Basic Item attributes</strong></p>
<p>The item also needs the required information of <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">type</span></code>. The <code class="docutils literal notranslate"><span class="pre">id</span></code> is a unique string which will be used to reference the correct item if there are multiple of the same name. The <code class="docutils literal notranslate"><span class="pre">type</span></code> gives information to the cart system about how the product should be manipulated and displayed. The type for a basic item is simply <code class="docutils literal notranslate"><span class="pre">item</span></code>.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Americano&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000000&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;item&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, we can add <code class="docutils literal notranslate"><span class="pre">price</span></code> and <code class="docutils literal notranslate"><span class="pre">calories</span></code> information. <code class="docutils literal notranslate"><span class="pre">price</span></code> should be represented as a float, while <code class="docutils literal notranslate"><span class="pre">calories</span></code> can be represented as a single integer or a list of two integers, indicating a calorie range. Modifiers can include their own information about how many calories they add/remove from the item, so the base calories here should represent the calories of the product when it has no modifications.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Americano&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000000&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span>
    <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mf">2.35</span><span class="p">,</span>
    <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="mi">15</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Additionally, we can add information to help the system categorize and query the item. This includes the fields: <code class="docutils literal notranslate"><span class="pre">aliases</span></code>, <code class="docutils literal notranslate"><span class="pre">categories</span></code>, and <code class="docutils literal notranslate"><span class="pre">tags</span></code>. All three of these fields are represented as lists of strings. <code class="docutils literal notranslate"><span class="pre">aliases</span></code> are list synonyms for item names, and help assist with finding the correct item for the user if they don’t use the exact name on the menu. <code class="docutils literal notranslate"><span class="pre">tags</span></code> carry semantic information and can help with extracting queries like “I want something sweet with coffee”. Finally, <code class="docutils literal notranslate"><span class="pre">categories</span></code> represent which menu categories the item belongs to, and helps present items when the user is viewing the menu.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Americano&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000000&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span>
    <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mf">2.35</span><span class="p">,</span>
    <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="nt">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;americano&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hot americano&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;hot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;espresso&quot;</span><span class="p">,</span>
        <span class="s2">&quot;beverage&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;categories&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Hot Coffee&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Espresso&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Supplementary information such as <code class="docutils literal notranslate"><span class="pre">description</span></code>, <code class="docutils literal notranslate"><span class="pre">image</span></code>, <code class="docutils literal notranslate"><span class="pre">ingredients</span></code>, and <code class="docutils literal notranslate"><span class="pre">recommendation_score</span></code> can be included. <code class="docutils literal notranslate"><span class="pre">description</span></code> and <code class="docutils literal notranslate"><span class="pre">image</span></code> are both strings, a description of the item and a url to an image. <code class="docutils literal notranslate"><span class="pre">ingredients</span></code> can be represented as a list of strings, and is useful if a user has some restrictions on what food/materials they will purchase. Lastly, the <code class="docutils literal notranslate"><span class="pre">recommendation_score</span></code> is an integer that is used to sort recommendations so that users are presented with the most popular or most promoted item.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Americano&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000000&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span>
    <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mf">2.35</span><span class="p">,</span>
    <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="nt">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;americano&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hot americano&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;hot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;espresso&quot;</span><span class="p">,</span>
        <span class="s2">&quot;beverage&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;categories&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Hot Coffee&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Espresso&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Espresso shots with hot water&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ingredients&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Espresso&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Water&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;https://coffee.americano.jpeg&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Modifier Groups</strong></p>
<p>We’ve finished adding all of the basic attributes of the item; now we need to include information about how the item can be modified. For this item, the user must specify if they want room or not, and can optionally ask for a packet of sweetener. We will represent these different modifications as modifier groups. Each item contains a list called <code class="docutils literal notranslate"><span class="pre">modifier_groups</span></code>, and each group within the list gives information about what options are available, how many at minimum/maximum may be selected, and whether or not the bot should ask the user about those specific options. First, we will add a <code class="docutils literal notranslate"><span class="pre">modifier_group</span></code> field to our item, and fill it with the name of our first group.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Americano&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000000&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span>
    <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mf">2.35</span><span class="p">,</span>
    <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="nt">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;americano&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hot americano&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;hot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;espresso&quot;</span><span class="p">,</span>
        <span class="s2">&quot;beverage&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;categories&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Hot Coffee&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Espresso&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Espresso shots with hot water&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ingredients&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Espresso&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Water&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;https://coffee.americano.jpeg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;modifier_groups&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We we also add a <code class="docutils literal notranslate"><span class="pre">category</span></code> field (to assist when users query about what type of options are available), <code class="docutils literal notranslate"><span class="pre">minimum</span></code>/<code class="docutils literal notranslate"><span class="pre">maximum</span></code> fields (integers that state the min and max number of modifiers that must be selected), and a <code class="docutils literal notranslate"><span class="pre">query_users_for_modifiers</span></code> field (that tells the bot whether or not it must ask the user about this group).</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room&quot;</span><span class="p">,</span>
    <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Fill Options&quot;</span><span class="p">,</span>
    <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;query_users_for_modifiers&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="s2">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Modifiers</strong></p>
<p>Here is also included a <code class="docutils literal notranslate"><span class="pre">modifiers</span></code> list. This list contains the information about which modifiers are available, and how they influence the total price and calories of the item. For room, we will have two modifiers: <code class="docutils literal notranslate"><span class="pre">room</span></code> and <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">room</span></code>. Because this modifier just specifies how much water the customer wants, neither option changes to the total price or calories. We will construct a modifier object containing the <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">id</span></code> (its unique id that references a standalone modifier specification in the menu’s top-level modifiers list), whether the item comes as a <code class="docutils literal notranslate"><span class="pre">default</span></code>, and the <code class="docutils literal notranslate"><span class="pre">price_change</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">calorie_change</span></code>.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room&quot;</span><span class="p">,</span>
    <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Fill Options&quot;</span><span class="p">,</span>
    <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;query_users_for_modifiers&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000001&quot;</span><span class="p">,</span>
            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;No Room&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000002&quot;</span><span class="p">,</span>
            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this case, our users must select at least one option from this group. However, <code class="docutils literal notranslate"><span class="pre">Room</span></code> is applied as a default so if the group is already satisfied. But, because <code class="docutils literal notranslate"><span class="pre">query_users_for_modifiers</span></code> is set to true, the bot will still ask the user for their choice.</p>
<p>We can use this first example to construct a modifier group for sweetener packets. For this group, no modifier is required, and the user can select as many of the options as they want.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sweetener Packets&quot;</span><span class="p">,</span>
    <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Sweeteners&quot;</span><span class="p">,</span>
    <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
    <span class="nt">&quot;query_users_for_modifiers&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sugar&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000003&quot;</span><span class="p">,</span>
            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">5</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Splenda&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000004&quot;</span><span class="p">,</span>
            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Raw Sugar&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000005&quot;</span><span class="p">,</span>
            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this example, we set the <code class="docutils literal notranslate"><span class="pre">maximum</span></code> to -1 to indicated that there is no limit to how many options can be selected from the group. Additionally, in this case <code class="docutils literal notranslate"><span class="pre">query_users_for_modifiers</span></code> is set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, and there are no default options, so sweetener packets will only be added to the item if the user specifically asks for it. As a final note, we can see that the <code class="docutils literal notranslate"><span class="pre">calorie_change</span></code> fields are being used. While the packets come complimentary, adding sugar to the item will cause the total calories to increase by 5-10.</p>
<p><strong>Variants</strong>
There is one other field that can be included on modifiers: a variant list. Variants are slight variations of a modifier. <code class="docutils literal notranslate"><span class="pre">Extra</span> <span class="pre">Cream</span></code> might be a variant for a <code class="docutils literal notranslate"><span class="pre">Cream</span></code> modifier on the Americano. By definition only one <code class="docutils literal notranslate"><span class="pre">variant</span></code> of a modifier can be selected at once. So, if the user has already added cream, but then corrects themselves and specifies <code class="docutils literal notranslate"><span class="pre">Extra</span> <span class="pre">Cream</span></code>, the <code class="docutils literal notranslate"><span class="pre">Cream</span></code> modifier will be removed, and the extra cream added. Here’s an example of a modifier with variants:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cream&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000006&quot;</span><span class="p">,</span>
    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="nt">&quot;variants&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Extra Cream&quot;</span><span class="p">,</span>
            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">35</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Light Cream&quot;</span><span class="p">,</span>
            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">15</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Full Basic Item Json Example</strong></p>
<p>Now let’s put all of this together to show our full menu with one complete item example:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;store_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Coffee Shop&quot;</span><span class="p">,</span>
    <span class="nt">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
    <span class="nt">&quot;products&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Americano&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000000&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span>
            <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mf">2.35</span><span class="p">,</span>
            <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
            <span class="nt">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;americano&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hot americano&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;hot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;espresso&quot;</span><span class="p">,</span>
                <span class="s2">&quot;beverage&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;categories&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;Hot Coffee&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Espresso&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Espresso shots with hot water&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ingredients&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;Espresso&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Water&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;https://coffee.americano.jpeg&quot;</span><span class="p">,</span>
            <span class="nt">&quot;modifier_groups&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Fill Options&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="nt">&quot;query_users_for_modifier&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Room&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000001&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;No Room&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000002&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sweetener Packets&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Sweeteners&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                    <span class="nt">&quot;query_users_for_modifier&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sugar&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000003&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">5</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Splenda&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000004&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Raw Sugar&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000005&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">10</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Creamer&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Add-ins&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                    <span class="nt">&quot;query_users_for_modifier&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cream&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000006&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                            <span class="nt">&quot;variants&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Extra Cream&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">35</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Light Cream&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">15</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Non-dairy Creamer&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000007&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                            <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">10</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>So we have completed our first basic <code class="docutils literal notranslate"><span class="pre">product</span></code> entry in the menu.</p>
</div>
<div class="section" id="combo-item-example">
<h3>Combo Item Example<a class="headerlink" href="#combo-item-example" title="Permalink to this headline">¶</a></h3>
<p>Next we’ll look at a slightly more complex type of product: the <code class="docutils literal notranslate"><span class="pre">combo</span></code>. A combo item has the same basic structure as a basic item, but is of type <code class="docutils literal notranslate"><span class="pre">combo</span></code>. The main difference between the two is that, while regular items can only be modified by modifiers, the combo’s modifier groups can contain modifiers or <em>other products</em>. Take for example a coffee and pastry combo. Customers may have the choice between regular or decaf coffee, and their choice of muffin, croissant, or bagel. Let’s construct an example.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Breakfast Pastry Combo&quot;</span><span class="p">,</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000008&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;combo&quot;</span><span class="p">,</span>
        <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mf">5.00</span><span class="p">,</span>
        <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">280</span><span class="p">,</span> <span class="mi">450</span><span class="p">],</span>
        <span class="nt">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;coffee and pastry combo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;breakfast combo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pastry combo&quot;</span>
        <span class="p">],</span>
        <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;breakfast&quot;</span><span class="p">,</span>
            <span class="s2">&quot;food&quot;</span><span class="p">,</span>
            <span class="s2">&quot;beverage&quot;</span><span class="p">,</span>
            <span class="s2">&quot;combo&quot;</span>
        <span class="p">],</span>
        <span class="nt">&quot;categories&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;Breakfast&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Combos&quot;</span>
        <span class="p">],</span>
        <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;House coffee with your choice of pastry&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ingredients&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;Coffee&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Flour&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Butter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Egg&quot;</span>
        <span class="p">],</span>
        <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;https://coffee.pastry.combo.jpeg&quot;</span><span class="p">,</span>
        <span class="nt">&quot;modifier_groups&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Coffee Choice&quot;</span><span class="p">,</span>
                <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Coffee Type&quot;</span><span class="p">,</span>
                <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nt">&quot;query_users_for_modifiers&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;House Coffee&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000009&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                        <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Decaf Coffee&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000010&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                        <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">},</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Pastry Choice&quot;</span><span class="p">,</span>
                <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Combo Choice&quot;</span><span class="p">,</span>
                <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nt">&quot;query_users_for_modifiers&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Muffin&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000011&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                        <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&quot;calorie_override&quot;</span><span class="p">:</span> <span class="mi">290</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Croissant&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000012&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                        <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">280</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bagel&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000013&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                        <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">440</span>
                    <span class="p">},</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bagel&quot;</span><span class="p">,</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000013&quot;</span><span class="p">,</span>
        <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>In this case, all of the objects in the modifier groups are referring to items on the <code class="docutils literal notranslate"><span class="pre">product</span></code> list. Additionally, because these are products, they can have their own modifier groups and can be customized by the user. It is essential that the <code class="docutils literal notranslate"><span class="pre">id</span></code> field points back to its stand-alone product on the product list. For example, if the user selects bagel, the cart can find item <code class="docutils literal notranslate"><span class="pre">000013</span></code> on the product list, and see that <code class="docutils literal notranslate"><span class="pre">bagel</span></code> has the option to be toasted.</p>
<p>The combo item can also have modifier groups containing modifier (rather than product) objects. A good example of this is if the combo item is ‘here’ or ‘to-go’. The use of a <code class="docutils literal notranslate"><span class="pre">modifier</span></code> in this case is affecting the whole combo item.</p>
</div>
<div class="section" id="virtual-item-example">
<h3>Virtual Item Example<a class="headerlink" href="#virtual-item-example" title="Permalink to this headline">¶</a></h3>
<p>The last type of product is of type <code class="docutils literal notranslate"><span class="pre">virtual</span></code>. A virtual product is similar to a combo, but always contains an item in one of its modifier groups whose details and own modifier groups the bot should treat as if they were those of the main item. For example, rather than selecting a panini sandwich, then choosing between ham and turkey as modifiers, a user would select the virtual Panini item, then select either <code class="docutils literal notranslate"><span class="pre">Ham</span> <span class="pre">Panini</span></code> or <code class="docutils literal notranslate"><span class="pre">Turkey</span> <span class="pre">Panini</span></code> as a modifier. The bot should then treat this selection as it were the actual cart item when displaying information. The menu implementation is nearly identical to a combo, but the cart treats these two types slightly differently. Here’s an example:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Panini&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000014&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;virtual&quot;</span><span class="p">,</span>
    <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mf">7.50</span><span class="p">,</span>
    <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="mi">350</span><span class="p">,</span>
    <span class="nt">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;panini sandwich&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pressed sandwich&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;lunch&quot;</span><span class="p">,</span>
        <span class="s2">&quot;food&quot;</span><span class="p">,</span>
        <span class="s2">&quot;savory&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;categories&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Lunch&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Sandwiches&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A pressed Italian sandwich.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;https://panini.jpeg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;modifier_groups&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Panini Type&quot;</span><span class="p">,</span>
            <span class="nt">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Panini Type&quot;</span><span class="p">,</span>
            <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;query_users_for_modifiers&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Turkey Bacon Panini&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000015&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ham Panini&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000010&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="nt">&quot;price_change&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="nt">&quot;calorie_change&quot;</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">},</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once the user has selected either ham or turkey panini, going forward the cart will always display <code class="docutils literal notranslate"><span class="pre">Turkey</span> <span class="pre">Bacon</span> <span class="pre">Panini</span></code> or <code class="docutils literal notranslate"><span class="pre">Ham</span> <span class="pre">Panini</span></code> as the item name, and the virtual item will inherit all of the customization available for either the turkey or ham item.</p>
</div>
<div class="section" id="the-modifier-list">
<h3>The Modifier list<a class="headerlink" href="#the-modifier-list" title="Permalink to this headline">¶</a></h3>
<p>Now that we have completed examples for each of the types of products available in the <code class="docutils literal notranslate"><span class="pre">products</span></code> list, there is one more menu attribute to complete: the <code class="docutils literal notranslate"><span class="pre">modifiers</span></code> list. This list, similar to the <code class="docutils literal notranslate"><span class="pre">products</span></code> list, contains objects for each <code class="docutils literal notranslate"><span class="pre">modifier</span></code> available on the menu. We looked at how modifiers are instantiated when they are applied to an item, but each unique modifier also has a stand-alone representation in the <code class="docutils literal notranslate"><span class="pre">modifiers</span></code> list. This object is very similar to our basic product object, including many of the same top-level attributes. Here’s an example using the ‘sugar packet’ example from before:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sugar&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000003&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;modifier&quot;</span><span class="p">,</span>
    <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A packet of white sugar.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;https://sugar.packet.jpg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;recommendation_score&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="nt">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;white packet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;white sugar&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;sweetener&quot;</span><span class="p">,</span>
        <span class="s2">&quot;packet&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here we have the sugar modifier object with all many of the fields we already saw in the <code class="docutils literal notranslate"><span class="pre">product</span></code> objects. Modifiers do have some unique attributes including <code class="docutils literal notranslate"><span class="pre">countable</span></code>, <code class="docutils literal notranslate"><span class="pre">quantity</span></code>, and <code class="docutils literal notranslate"><span class="pre">unit_of_measure</span></code>, which help define how modifiers can be quantified. Additionally, the modifier also has a <code class="docutils literal notranslate"><span class="pre">variants</span></code> field, which should contain all the possible variants for that modifier, in the same format as they appeared when attached to an item. Here is a full example with the new fields:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sugar&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;000003&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;modifier&quot;</span><span class="p">,</span>
    <span class="nt">&quot;price&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;calories&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A packet of white sugar.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;https://sugar.packet.jpg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;recommendation_score&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="nt">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;white packet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;white sugar&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;sweetener&quot;</span><span class="p">,</span>
        <span class="s2">&quot;packet&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;countable&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;unit_of_measure&quot;</span><span class="p">:</span> <span class="s2">&quot;packet(s)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;variants&quot;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>All modifiers that are found within a product’s <code class="docutils literal notranslate"><span class="pre">modifier_groups</span></code> must have a matching <code class="docutils literal notranslate"><span class="pre">id</span></code> with the stand-alone modifier object in the <code class="docutils literal notranslate"><span class="pre">modifiers</span></code> list. The modifier attached to the item may reference the stand-alone modifier to get immutable information such as <code class="docutils literal notranslate"><span class="pre">aliases</span></code>, <code class="docutils literal notranslate"><span class="pre">description</span></code>, and <code class="docutils literal notranslate"><span class="pre">image</span></code>.</p>
</div>
</div>
<div class="section" id="a-complete-menu-example">
<h3>A Complete Menu Example<a class="headerlink" href="#a-complete-menu-example" title="Permalink to this headline">¶</a></h3>
<p>Now that we have completed an example of each element on the menu, we can put it all together to create a full example menu. View the full example <a class="reference internal" href="example_menu.html"><span class="doc">here</span></a>.</p>
</div>
</div>
<div class="section" id="generating-lookup-tables-chatette-templates">
<h2>Generating Lookup Tables &amp; Chatette Templates<a class="headerlink" href="#generating-lookup-tables-chatette-templates" title="Permalink to this headline">¶</a></h2>
<p><strong>Chatette</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">cart.py</span></code> file has two methods to assist with exporting NLU training data from the menu. Additionally, there are two convenience scripts available to call these methods. The first script is <code class="docutils literal notranslate"><span class="pre">generate_chatette.py</span></code>. We can run the script with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">generate_chatette</span><span class="o">.</span><span class="n">py</span> <span class="p">{</span><span class="n">menu</span> <span class="n">file</span> <span class="n">path</span><span class="p">}</span> <span class="p">{</span><span class="n">output</span> <span class="n">file</span> <span class="n">path</span><span class="p">}</span>
</pre></div>
</div>
<p>This outputs a <a class="reference external" href="https://github.com/SimGus/Chatette">chatette</a> formatted file that contains entity examples for <code class="docutils literal notranslate"><span class="pre">items</span></code>, <code class="docutils literal notranslate"><span class="pre">modifiers</span></code>, <code class="docutils literal notranslate"><span class="pre">query_topics</span></code>. The item and modifier examples will include a set of the names of all of <code class="docutils literal notranslate"><span class="pre">products</span></code>, <code class="docutils literal notranslate"><span class="pre">modifiers</span></code>, and <code class="docutils literal notranslate"><span class="pre">aliases</span></code> present in the menu. The query topic examples include a set of all menu <code class="docutils literal notranslate"><span class="pre">categories</span></code> and <code class="docutils literal notranslate"><span class="pre">tags</span></code>, helpful for when the user queries the menu. You can see an the full extracted file from our example menu <a class="reference internal" href="example_chatette.html#example-chatette"><span class="std std-ref">here</span></a>.</p>
<p>To load this file into a common Chatette file, make sure all your chatette files are in the same directory and then include the following in your main chatette file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span><span class="n">menu</span><span class="o">.</span><span class="n">chatette</span> <span class="o">//</span> <span class="n">The</span> <span class="n">file</span> <span class="n">name</span> <span class="n">of</span> <span class="n">your</span> <span class="n">Menu</span><span class="o">-</span><span class="n">specific</span> <span class="n">templates</span>
</pre></div>
</div>
<p><strong>Lookup Tables</strong></p>
<p>You can generate Rasa lookup tables with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">generate_lookup_tables</span><span class="o">.</span><span class="n">py</span> <span class="p">{</span><span class="n">menu</span> <span class="n">file</span> <span class="n">path</span><span class="p">}</span> <span class="p">{</span><span class="n">output</span> <span class="n">directory</span><span class="p">}</span>
</pre></div>
</div>
<p>This script will output individual files for <code class="docutils literal notranslate"><span class="pre">items</span></code>, <code class="docutils literal notranslate"><span class="pre">modifiers</span></code>, and <code class="docutils literal notranslate"><span class="pre">query_topics</span></code>. These files contain the same information at the chatette file, but just in a different format. You can see the result from our example menu <a class="reference internal" href="example_lookup.html#lookup-example"><span class="std std-ref">here</span></a>.</p>
<p>To use these lookup tables, include references in your bot’s NLU data. While these can go in any NLU data file used by the bot, we suggest keeping them in an <code class="docutils literal notranslate"><span class="pre">extra_nlu.md</span></code> file, which includes bot-specific NLU data not generated from templates or real users. To include them, you would append the following:</p>
<div class="highlight-MD notranslate"><div class="highlight"><pre><span></span><span class="gu">## lookup:item</span>
path/to/items.txt

<span class="gu">## lookup:options</span>
path/to/options.txt

<span class="gu">## lookup:query_topics</span>
path/to/query_topics.txt
</pre></div>
</div>
</div>
<div class="section" id="writing-the-cart-config-yml-file">
<h2>Writing the cart_config.yml File<a class="headerlink" href="#writing-the-cart-config-yml-file" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a working menu, we can prepare to integrate ngChat Cart with our bot. First, we’ll need to set up a cart config file so that we can adjust the cart settings and set up our menu path. The following is a list of configurable parameters, with their default values listed:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 12%" />
<col style="width: 37%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>NAME</p></th>
<th class="head"><p>TYPE</p></th>
<th class="head"><p>DESCRIPTION</p></th>
<th class="head"><p>DEFAULT VALUE</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MENU_PATHS</p></td>
<td><p>List[Text]</p></td>
<td><p>A list of paths to menu files that
will be loaded by the cart</p></td>
<td><p>[]</p></td>
</tr>
<tr class="row-odd"><td><p>ES_HOST</p></td>
<td><p>Text</p></td>
<td><p>The host name for the ElasticSearch
client</p></td>
<td><p>‘localhost’</p></td>
</tr>
<tr class="row-even"><td><p>ES_PORT</p></td>
<td><p>int</p></td>
<td><p>The port name for the ElasticSearch
client</p></td>
<td><p>9200</p></td>
</tr>
<tr class="row-odd"><td><p>ES_TRY_LOCAL_FIRST</p></td>
<td><p>bool</p></td>
<td><p>Whether or not the cart should try
to connect to a local ElasticSearch
instance before trying whatever is
specified in ES_HOST</p></td>
<td><p>True</p></td>
</tr>
<tr class="row-even"><td><p>FUZZY_MATCH_THRESH</p></td>
<td><p>int</p></td>
<td><p>A threshold for an string match
(highly confident) when matching
user requests to menu information.
Between [0, 100]</p></td>
<td><p>85</p></td>
</tr>
<tr class="row-odd"><td><p>FUZZY_SUGGEST_THRESH</p></td>
<td><p>int</p></td>
<td><p>A threshold for less-confident fuzzy
matching. If a fuzzy match score is
below FUZZY_MATCH_THRESH but higher
than FUZZY_SUGGEST_THRESH, the bot
should confirm with the user or offer
suggestions</p></td>
<td><p>70</p></td>
</tr>
<tr class="row-even"><td><p>ES_MATCH_THRESH</p></td>
<td><p>float</p></td>
<td><p>A threshold for confident matching
when using ElasticSearch</p></td>
<td><p>3.5</p></td>
</tr>
<tr class="row-odd"><td><p>ES_SUGGEST_THRESH</p></td>
<td><p>float</p></td>
<td><p>A threshold for returning item
suggestions</p></td>
<td><p>1.8</p></td>
</tr>
<tr class="row-even"><td><p>ES_UNIQUE_THRESH</p></td>
<td><p>float</p></td>
<td><p>A threshold for determining unique
matches with ElasticSearch. If ES is
asked to return one highly-confident
match, the second best match must be
lower in confidence by at least
ES_UNIQUE_THRESH from the top match.</p></td>
<td><p>.3</p></td>
</tr>
<tr class="row-odd"><td><p>ES_MULTI_MATCH_TYPE</p></td>
<td><p>Text</p></td>
<td><p>Multi match type parameter for
ElasticSearch. Can be either
‘best_fields’ or ‘cross_fields’</p></td>
<td><p>‘best_fields’</p></td>
</tr>
<tr class="row-even"><td><p>ES_MULTI_MATCH_FIELDS</p></td>
<td><p>List[Text]</p></td>
<td><p>Which fields to consult with multi
match when querying for an item
with ES.</p></td>
<td><p>[‘modifier_names’, ‘tags’,
‘categories’]</p></td>
</tr>
</tbody>
</table>
<p>Most defaults will work fine for running locally, but before running on a cluster the ElasticSearch <code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> must be configured. The various thresholds can be raised or lowered to adjust how the bot will user queries.</p>
</div>
<div class="section" id="integrating-with-rasa">
<h2>Integrating with Rasa<a class="headerlink" href="#integrating-with-rasa" title="Permalink to this headline">¶</a></h2>
<p>Once a valid menu is created and the cart setting are configured, ngChat Cart can be integrated with Rasa. The only point of contact between the bot and the cart system is through <code class="docutils literal notranslate"><span class="pre">actions.py</span></code>. The bot is in charge of extracting intents &amp; entities from user utterances and deciding which actions to execute next. During action execution, custom actions can call <code class="docutils literal notranslate"><span class="pre">cart.py</span></code> methods in order to pass slot data to the cart, manipulate the user’s cart, request information from the cart, etc.</p>
<div class="section" id="importing-configuring-and-loading-menus">
<h3>Importing, Configuring, and Loading Menus<a class="headerlink" href="#importing-configuring-and-loading-menus" title="Permalink to this headline">¶</a></h3>
<p>Before calling methods from <code class="docutils literal notranslate"><span class="pre">cart.py</span></code>, however, there is a bit more configuration that must be done in the actions file itself. First, upon bot startup, the cart should be configured and the menus loaded. This can be accomplished with the follow code heading the actions file:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ngchat_cart</span> <span class="kn">import</span> <span class="n">cart</span>
<span class="n">cart</span><span class="o">.</span><span class="n">load_config</span><span class="p">({</span><span class="n">path</span> <span class="n">to</span> <span class="n">config</span> <span class="n">file</span><span class="p">})</span>
<span class="n">cart</span><span class="o">.</span><span class="n">load_menus</span><span class="p">()</span>
</pre></div>
</div>
<p>This will initialize an instance of <code class="docutils literal notranslate"><span class="pre">cart.py</span></code> that has the appropriate menus and configurations for the bot.</p>
</div>
<div class="section" id="session-start">
<h3>Session Start<a class="headerlink" href="#session-start" title="Permalink to this headline">¶</a></h3>
<p>Next, upon session start the bot will need to initialize a <code class="docutils literal notranslate"><span class="pre">Cart</span></code> object for the specific user. Here it is recommended to override Rasa’s built in <code class="docutils literal notranslate"><span class="pre">ActionSessionStart</span></code> action, as is shown in the following example:</p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ActionSessionStart</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform actions when user begins a session with the bot.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Text</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set action name to action_session_start.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;action_session_start&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dispatcher</span><span class="p">:</span> <span class="n">CollectingDispatcher</span><span class="p">,</span>
        <span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span>
        <span class="n">domain</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EventType</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Initialize a user&#39;s cart and menu at session start.</span>

<span class="sd">        Return:</span>
<span class="sd">            SessionStarted action(required)</span>
<span class="sd">            Carry over slot sets</span>
<span class="sd">            Execute action_listen</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_cart</span> <span class="o">=</span> <span class="n">cart</span><span class="o">.</span><span class="n">get_user_cart</span><span class="p">(</span><span class="n">tracker</span><span class="o">.</span><span class="n">sender_id</span><span class="p">)</span>
        <span class="c1"># if the bot only uses one menu, simply load pre-load the menu</span>
        <span class="n">user_cart</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">get_matching_menu</span><span class="p">(</span><span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">menu</span><span class="p">:</span>
            <span class="ne">Warning</span><span class="p">(</span><span class="s2">&quot;There was an error loading the menu&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">SessionStarted</span><span class="p">(),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;cart_dump&#39;</span><span class="p">,</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">cart_dump</span><span class="p">()),</span>
                <span class="n">ActionExecuted</span><span class="p">(</span><span class="s1">&#39;action_listen&#39;</span><span class="p">)]</span>
</pre></div>
</td></tr></table></div>
<p>This action is accomplishing several things. First, it is grabbing the user’s existing cart, or creating a new cart object via the lru cache in the <code class="docutils literal notranslate"><span class="pre">get_user_cart</span></code> method. It is essential that cart objects are accessed via the user’s <code class="docutils literal notranslate"><span class="pre">sender_id</span></code>, otherwise users would all share one cart object, or the objects would get mixed up between users. Whenever accessing or manipulating the user cart, it must first be retrieved with the <code class="docutils literal notranslate"><span class="pre">get_user_cart</span></code> method.</p>
<p>Second, if the bot only uses one menu, or there is a default menu, the bot should automatically load the menu at session start. If some information is needed prior to loading the menu, line 24 can be excluded.</p>
<p>Finally, the action returns the <code class="docutils literal notranslate"><span class="pre">SessionStarted</span></code> event. This event <em>must</em> be returned first in the event list of this action. From there, you can also set any slots that the bot should have pre-filled at session start. In this case, the example uses the <code class="docutils literal notranslate"><span class="pre">cart_dump</span></code> method to fill the bot’s <code class="docutils literal notranslate"><span class="pre">cart_dump</span></code> slot. The cart dump is essentially a dictionary representation of useful information extracted from the current cart status. This can be used by the dialogue manager to check the status of the cart and have the bot execute certain actions accordingly. Lastly, the bot must also return an <code class="docutils literal notranslate"><span class="pre">ActionExecuted('action_listen')</span></code> event. This will ensure that after the session start action has finished, the next action to be executed will always be <code class="docutils literal notranslate"><span class="pre">action_listen</span></code>.</p>
</div>
<div class="section" id="calling-cart-methods-from-actions">
<h3>Calling Cart Methods from Actions<a class="headerlink" href="#calling-cart-methods-from-actions" title="Permalink to this headline">¶</a></h3>
<p>Once the actions file is configured, all custom actions in the file can access the user cart and call methods from <code class="docutils literal notranslate"><span class="pre">cart.py</span></code>. There are some actions that can be called on their own, and do not need to work together with other actions. These can be tasks like: showing the menu, giving suggestions, and checking the contents of the cart.</p>
<p>Other tasks, like adding an item to the cart, require a more complex navigation of dialogue &amp; actions. For example, when a user requests an item to be added to the cart, the <code class="docutils literal notranslate"><span class="pre">item</span></code> and <code class="docutils literal notranslate"><span class="pre">modifier</span></code> slots should first be validated with the menu to make sure the user has requested a legitimate item. Next, a new <code class="docutils literal notranslate"><span class="pre">CartItem</span></code> object should be created and any user-specified modifiers added. The bot should then ask the user if they want to customize it any more, and if not finally confirm if the user wants to add it, then add the item to the cart. This flow will require several actions that work together, calling methods and passing slots back and forth.</p>
</div>
<div class="section" id="action-examples">
<h3>Action Examples<a class="headerlink" href="#action-examples" title="Permalink to this headline">¶</a></h3>
<p><strong>Displaying the Menu</strong></p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DescribeMenu</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Text</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;action_describe_menu&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">:</span> <span class="n">CollectingDispatcher</span><span class="p">,</span>
            <span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">Domain</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Describe menu in general terms, such as categories.&quot;&quot;&quot;</span>
        <span class="c1"># ALWAYS get the user cart with the sender id first</span>
        <span class="n">user_cart</span> <span class="o">=</span> <span class="n">cart</span><span class="o">.</span><span class="n">get_user_cart</span><span class="p">(</span><span class="n">tracker</span><span class="o">.</span><span class="n">sender_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">user_cart</span> <span class="ow">and</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">menu</span><span class="p">:</span>
            <span class="c1"># dispatch the menu description directly to the user</span>
            <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="n">user_cart</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">describe_menu</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</td></tr></table></div>
<p>In this case, the cart method is returning a string that can be directly presented to the user via the Rasa dispatcher.</p>
<p><strong>Displaying Item Suggestions</strong></p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GiveRecommendations</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Text</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;action_give_recommendations&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">:</span> <span class="n">CollectingDispatcher</span><span class="p">,</span>
            <span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Based on the category, dispatch recommended items.&quot;&quot;&quot;</span>
        <span class="c1"># Build keyword search query from slots</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">slot_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">]:</span>
            <span class="n">keyword_slot</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">slots</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slot_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">keyword_slot</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keyword_slot</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">keyword_slot</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keyword_slot</span><span class="p">)</span>

        <span class="c1"># Get the user cart</span>
        <span class="n">user_cart</span> <span class="o">=</span> <span class="n">cart</span><span class="o">.</span><span class="n">get_user_cart</span><span class="p">(</span><span class="n">tracker</span><span class="o">.</span><span class="n">sender_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_cart</span> <span class="ow">and</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">menu</span><span class="p">:</span>
            <span class="n">suggest_item</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="c1"># submit a query with the item name and keywords</span>
            <span class="n">suggestions</span> <span class="o">=</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">query_item_suggestions</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">suggest_item</span><span class="p">,</span>
                <span class="n">keywords</span><span class="o">=</span><span class="n">keywords</span><span class="p">)</span>

            <span class="c1"># dispatch a message based on the results</span>
            <span class="k">if</span> <span class="n">suggestions</span><span class="p">:</span>
                <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Here are some suggested items:</span><span class="si">{</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">suggestions</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">((</span>
                    <span class="s2">&quot;I&#39;m not able to find anything like that on the menu. Please try re-phrasing &quot;</span>
                    <span class="s2">&quot;your request or ask me about the menu to see what&#39;s available.&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="s2">&quot;I&#39;m having trouble accessing your menu. Try restarting.&quot;</span><span class="p">)</span>

        <span class="c1"># The slots query_topics and items have served their purpose</span>
        <span class="c1"># of getting recommendations, now we clear them</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;query_topics&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[])]</span>
</pre></div>
</td></tr></table></div>
<p>In this action, the bot likely extracted <code class="docutils literal notranslate"><span class="pre">query_topic</span></code> or <code class="docutils literal notranslate"><span class="pre">item</span></code> entities related to what the user wants from the menu. After the action is complete, the slots have served their purpose and should be cleared so that they do not affect the next dialogue turn.</p>
<p><strong>Validating an Item</strong></p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ValidateItem</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Text</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;action_validate_item&#39;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">:</span> <span class="n">CollectingDispatcher</span><span class="p">,</span>
            <span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Check that the requested item is in the menu.&quot;&quot;&quot;</span>
        <span class="c1"># Get user cart</span>
        <span class="n">user_cart</span> <span class="o">=</span> <span class="n">cart</span><span class="o">.</span><span class="n">get_user_cart</span><span class="p">(</span><span class="n">tracker</span><span class="o">.</span><span class="n">sender_id</span><span class="p">)</span>

        <span class="c1"># get keywords to assist with item query</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;query_topics&#39;</span><span class="p">):</span>
            <span class="n">keywords</span> <span class="o">+=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;query_topics&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">):</span>
            <span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">))</span>

        <span class="c1"># query the menu for a matching item</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">get_matching_menu_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I couldn&#39;t find an exact match for: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">)</span>
                <span class="c1"># if no match, offer some suggestions</span>
                <span class="n">similar_items</span> <span class="o">=</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">get_similar_menu_items</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">similar_items</span><span class="p">:</span>
                    <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I found something similar to </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">similar_items</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="n">FollowupAction</span><span class="p">(</span><span class="s1">&#39;action_listen&#39;</span><span class="p">)]</span>

            <span class="k">elif</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Let&#39;s customize the </span><span class="si">{</span><span class="n">match</span><span class="si">}</span><span class="s2">. &quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
</pre></div>
</td></tr></table></div>
<p>This action queries the menu in a similar fashion to the recommendation action. If it finds an exact match, it will set the <code class="docutils literal notranslate"><span class="pre">item</span></code> slot to the normalized item name from the menu. This will allow the dialogue policy to see the updated item and move forward with dialogue flow. If there is no matching item, the action will offer suggestions of similar items, and then set the <code class="docutils literal notranslate"><span class="pre">item</span></code> slot to None. This tells the bot that the item was not successfully validated. The action will also force an <code class="docutils literal notranslate"><span class="pre">action_listen</span></code>, giving the user a chance to clarify their request.</p>
<p>Modifiers that users specify also go through a similar validation process before being added to an item.</p>
<p><strong>Creating a New CartItem</strong></p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UpdateActiveItem</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to add item to cart.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Text</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set action name to action_prepare_add_to_cart.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;action_update_active_item&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">:</span> <span class="n">CollectingDispatcher</span><span class="p">,</span>
            <span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Create a new cart item from a verified item.&quot;&quot;&quot;</span>
        <span class="c1"># Get user cart</span>
        <span class="n">user_cart</span> <span class="o">=</span> <span class="n">cart</span><span class="o">.</span><span class="n">get_user_cart</span><span class="p">(</span><span class="n">tracker</span><span class="o">.</span><span class="n">sender_id</span><span class="p">)</span>

        <span class="c1"># item slot should be validated at this point from validation step, but it&#39;s good to make sure the slot is filled</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
            <span class="c1"># Create a new CartItem object from the item name</span>
            <span class="c1"># Store the new CartItem in the active_item field of the user&#39;s cart</span>
            <span class="n">user_cart</span><span class="o">.</span><span class="n">active_item</span> <span class="o">=</span> <span class="n">cart</span><span class="o">.</span><span class="n">CartItem</span><span class="o">.</span><span class="n">from_item_name</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">menu</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in action_update_active_item: item is None&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;item_to_add&quot;</span><span class="p">,</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">active_item</span><span class="o">.</span><span class="n">to_text</span><span class="p">()),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">menu_items</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">image</span> <span class="k">if</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">menu</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">)),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;cart_dump&#39;</span><span class="p">,</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">cart_dump</span><span class="p">())]</span>
</pre></div>
</td></tr></table></div>
<p>In this action, we can assume that the validation step has already occurred, and the name in the <code class="docutils literal notranslate"><span class="pre">item</span></code> slot is ready to be turned into a <code class="docutils literal notranslate"><span class="pre">CartItem</span></code>. By creating a new <code class="docutils literal notranslate"><span class="pre">CartItem</span></code> and storing it in the <code class="docutils literal notranslate"><span class="pre">active_item</span></code> attribute of the user’s cart, the new object can be accessed from any of the other methods. If the user specified a modification to the item, it would be validated, turned into a <code class="docutils literal notranslate"><span class="pre">CartModifier</span></code> object, and added to the active item.</p>
<p>Note again that the action clears the <code class="docutils literal notranslate"><span class="pre">item</span></code> slot after its done using it. Additionally it fills some helper slots like <code class="docutils literal notranslate"><span class="pre">item_to_add</span></code> and <code class="docutils literal notranslate"><span class="pre">image</span></code> which can be used by the bot to display information about the item to the user. Finally, the action also updates the <code class="docutils literal notranslate"><span class="pre">cart_dump</span></code> slot, which will reflect the change in <code class="docutils literal notranslate"><span class="pre">active_item</span></code>. Again, this slot can be used by the dialogue manager to decide which action to execute next, given the fact that there is an active item in the cart.</p>
<p><strong>Adding an Item to the Cart</strong></p>
<p>Once an item is validated, converted to a <code class="docutils literal notranslate"><span class="pre">CartItem</span></code>, &amp; modified, it can finally be added to the user’s cart.</p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AddToCart</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to add item to cart.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Text</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set action name to action_add_to_cart.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;action_add_to_cart&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">:</span> <span class="n">CollectingDispatcher</span><span class="p">,</span>
            <span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Add item to cart.&quot;&quot;&quot;</span>
        <span class="c1"># Get user cart</span>
        <span class="n">user_cart</span> <span class="o">=</span> <span class="n">cart</span><span class="o">.</span><span class="n">get_user_cart</span><span class="p">(</span><span class="n">tracker</span><span class="o">.</span><span class="n">sender_id</span><span class="p">)</span>

        <span class="c1"># Add the active item to the cart</span>
        <span class="n">user_cart</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">user_cart</span><span class="o">.</span><span class="n">active_item</span><span class="p">,</span> <span class="n">tracker</span><span class="o">.</span><span class="n">sender_id</span><span class="p">)</span>
        <span class="c1"># affirm that the action is complete, and reset the active item</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s1">&#39;utter_affirm_add&#39;</span><span class="p">)</span>
        <span class="n">user_cart</span><span class="o">.</span><span class="n">active_item</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Reset all slots that may have been carrying information about the active item.</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;num_cart_items&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_cart</span><span class="o">.</span><span class="n">cart_items</span><span class="p">)),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">)),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;query_topics&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;item_description&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;target_cart_item&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;receipt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;cart_total&quot;</span><span class="p">,</span> <span class="n">cart</span><span class="o">.</span><span class="n">price_to_text</span><span class="p">(</span><span class="n">user_cart</span><span class="o">.</span><span class="n">sum_price</span><span class="p">())),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;cart_dump&#39;</span><span class="p">,</span> <span class="n">user_cart</span><span class="o">.</span><span class="n">cart_dump</span><span class="p">()),</span>
                <span class="n">SlotSet</span><span class="p">(</span><span class="s1">&#39;item_to_add&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
</pre></div>
</td></tr></table></div>
<p>Once the active item is fully customized, the process of adding it to the cart is a matter of just calling one function. The most important part of this action is wiping the bot clean of any lingering information about the added item. Now that the item is in the cart, we don’t want any of the information that we used when adding it to get mixed up with whatever the user asks next. If the user wants to access the added item, they will now need to request to modify or remove the item from the cart.</p>
</div>
<div class="section" id="notes-on-best-practices">
<h3>Notes on Best Practices<a class="headerlink" href="#notes-on-best-practices" title="Permalink to this headline">¶</a></h3>
<p>The following are some quick notes concerning best practices, to keep in mind while developing.</p>
<p><strong>Pass by Reference</strong></p>
<p>Pass by Reference when possible to reduce string matching &amp; <code class="docutils literal notranslate"><span class="pre">ElasticSearch</span></code> calls. While this isn’t always possible (for example if you have to confirm something with the user or store a value as a string in a slot) it is worth keeping in mind as it can improve performance. Within actions, if calling multiple methods from <code class="docutils literal notranslate"><span class="pre">cart.py</span></code>, do try to pass objects by reference whenever possible.</p>
<p><strong>Updating the Menu</strong></p>
<p>It is highly suggested when creating the menu to keep a master copy of the menu, and a secondary menu file containing only values that may change or be updated over time. This way, you always have a master copy of the menu they will never be changed or overwritten. The variable file will also be smaller and easier to update by hand. If you write a simple script to merge the two and produce and updated menu file, it can greatly simplify the process of updating the menu.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ngchat/faq.html" class="btn btn-neutral float-right" title="ngChat-FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../policy/policy_tutorial.html" class="btn btn-neutral float-left" title="ngChat Policy Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Seasalt.ai

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-10405841-8', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>